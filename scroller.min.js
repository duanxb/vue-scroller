Vue.component("bubble",{template:'<canvas ref="bubble" :width="width" :height="height" :style="style"></canvas>',props:{y:{type:Number,default:0}},data:function(){return{width:50,height:80}},computed:{distance:function(){return Math.max(0,Math.min(this.y*this.ratio,this.maxDistance))},style:function(){return"width:"+this.width/this.ratio+"px;height:"+this.height/this.ratio+"px"}},created:function(){this.ratio=window.devicePixelRatio,this.width*=this.ratio,this.height*=this.ratio,this.initRadius=18*this.ratio,this.minHeadRadius=12*this.ratio,this.minTailRadius=5*this.ratio,this.initArrowRadius=10*this.ratio,this.minArrowRadius=6*this.ratio,this.arrowWidth=3*this.ratio,this.maxDistance=40*this.ratio,this.initCenterX=25*this.ratio,this.initCenterY=25*this.ratio,this.headCenter={x:this.initCenterX,y:this.initCenterY}},mounted:function(){this._draw()},methods:{_draw:function(){var t=this.$refs.bubble,i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),this._drawBubble(i),this._drawArrow(i)},_drawBubble:function(t){t.save(),t.beginPath();var i=this.distance/this.maxDistance,e=this.initRadius-(this.initRadius-this.minHeadRadius)*i;this.headCenter.y=this.initCenterY-(this.initRadius-this.minHeadRadius)*i,t.arc(this.headCenter.x,this.headCenter.y,e,0,Math.PI,!0);var l=this.initRadius-(this.initRadius-this.minTailRadius)*i,s={x:this.headCenter.x,y:this.headCenter.y+this.distance},o={x:s.x-l,y:s.y},n={x:o.x,y:o.y-this.distance/2};t.quadraticCurveTo(n.x,n.y,o.x,o.y),t.arc(s.x,s.y,l,Math.PI,0,!0);var r={x:this.headCenter.x+e,y:this.headCenter.y},a={x:s.x+l,y:r.y+this.distance/2};t.quadraticCurveTo(a.x,a.y,r.x,r.y),t.fillStyle="rgb(170,170,170)",t.fill(),t.strokeStyle="rgb(153,153,153)",t.stroke(),t.restore()},_drawArrow:function(t){t.save(),t.beginPath();var i=this.distance/this.maxDistance,e=this.initArrowRadius-(this.initArrowRadius-this.minArrowRadius)*i;t.arc(this.headCenter.x,this.headCenter.y,e-(this.arrowWidth-i),-Math.PI/2,0,!0),t.arc(this.headCenter.x,this.headCenter.y,e,0,3*Math.PI/2,!1),t.lineTo(this.headCenter.x,this.headCenter.y-e-this.arrowWidth/2+i),t.lineTo(this.headCenter.x+2*this.arrowWidth-2*i,this.headCenter.y-e+this.arrowWidth/2),t.lineTo(this.headCenter.x,this.headCenter.y-e+3*this.arrowWidth/2-i),t.fillStyle="rgb(255,255,255)",t.fill(),t.strokeStyle="rgb(170,170,170)",t.stroke(),t.restore()}},watch:{y:function(){this._draw()}}}),Vue.component("scroller",{template:'<div class="scroller" :class="stylename" ref="wrapper">                    <div class="content">                        <slot></slot>                        <slot name="pullup">                            <div class="pullup-wrapper" v-if="pullup">                                <span v-if="!isPullUpLoad">{{refreshTxt}}</span>                                <span v-else class="loading" >                                <img src="/static/imgs/vuemodal/loading-bubbles.svg" />                                </span>                            </div>                        </slot>                    </div>                    <slot name="pulldown">                        <div ref="pulldown" class="pulldown-wrapper" :style="pullDownStyle" v-if="pulldown">                            <div class="before-trigger" v-if="beforePullDown">                                <bubble :y="bubbleY"></bubble>                            </div>                            <div class="after-trigger" v-else>                                <div v-if="isPullingDown" class="loading">                                <img src="/static/imgs/vuemodal/loading-bubbles.svg" />                                </div>                                <div v-else><span>{{refreshTxt}}</span></div>                            </div>                        </div>                    </solt>                </div>',props:{probeType:{type:Number,default:1},click:{type:Boolean,default:!0},scrollX:{type:Boolean,default:!1},listenScroll:{type:Boolean,default:!1},data:{type:Array,default:null},pullup:{type:Boolean,default:!1},pulldown:{type:Boolean,default:!1},beforeScroll:{type:Boolean,default:!1},refreshDelay:{type:Number,default:20},stylename:{type:String,default:""},scrollToEndFlag:{type:Boolean,default:!1}},data:function(){return{pullUpDirty:!0,isPullUpLoad:!1,isPullingDown:!1,beforePullDown:!0,pullDownStyle:"",bubbleY:0,isRebounding:!1}},computed:{refreshTxt:function(){return this.pullUpDirty?"加载成功":"没有更多的数据"}},created:function(){this.pullDownInitTop=-50,this.pullDownRefreshStop=40},mounted:function(){var t=this;setTimeout(function(){t._initScroll()},20)},methods:{_initScroll:function(){var t=this;this.$refs.wrapper&&(this.scroll=new BScroll(this.$refs.wrapper,{probeType:this.probeType,click:this.click,preventDefaultException:{className:/(^|\s)prevent-exception(\s|$)/},scrollX:this.scrollX,pullUpLoad:this.pullup,pullDownRefresh:this.pulldown}),this.listenScroll&&this.scroll.on("scroll",function(i){t.$emit("scroll",i)}),this.pullup&&this.scroll.on("pullingUp",function(){t.isPullUpLoad=!0,t.$emit("pullup")}),this.pulldown&&(this.scroll.on("pullingDown",function(){t.beforePullDown=!1,t.isPullingDown=!0,t.$emit("pulldown")}),this.scroll.on("scroll",function(i){t.pulldown&&(t.beforePullDown?(t.bubbleY=Math.max(0,i.y+t.pullDownInitTop),t.pullDownStyle="top:"+Math.min(i.y+t.pullDownInitTop,10)+"px"):t.bubbleY=0,t.isRebounding&&(t.pullDownStyle="top:"+(10-(t.pullDownRefreshStop-i.y))+"px"))})),this.beforeScroll&&this.scroll.on("beforeScrollStart",function(){t.$emit("beforeScroll")}),this.scrollToEndFlag&&this.scrollToEnd())},disable:function(){this.scroll&&this.scroll.disable()},enable:function(){this.scroll&&this.scroll.enable()},refresh:function(){this.scroll&&this.scroll.refresh()},forceUpdate:function(t){var i=this;this.pullup&&this.isPullUpLoad?(this.isPullUpLoad=!1,this.scroll.finishPullUp(),this.pullUpDirty=t,this.refresh()):this.pulldown&&this.isPullingDown?(this.isPullingDown=!1,this.pullUpDirty=t,this._reboundPullDown(function(){i._afterPullDown()})):this.refresh()},_reboundPullDown:function(t){var i=this,e=this.pulldown.stopTime,l=void 0===e?600:e;setTimeout(function(){i.isRebounding=!0,i.scroll.finishPullDown(),t()},l)},_afterPullDown:function(){var t=this;setTimeout(function(){t.pullDownStyle="top:"+t.pullDownInitTop+"px",t.beforePullDown=!0,t.isRebounding=!1,t.refresh()},this.scroll.options.bounceTime)},scrollTo:function(){this.scroll&&this.scroll.scrollTo.apply(this.scroll,arguments)},scrollToEnd:function(t){var i=this;t=t||0,setTimeout(function(){i.scroll.scrollTo(0,i.scroll.maxScrollY,t)},200)},scrollToElement:function(){this.scroll&&this.scroll.scrollToElement.apply(this.scroll,arguments)}},watch:{data:function(){var t=this;setTimeout(function(){t.forceUpdate(!0)},this.refreshDelay)}}});